---
- name: Install git
  ansible.builtin.apt:
    name:
      - git
    state: present
  become: yes

- name: install nomad
  shell: >
    sudo apt-get update && 
    sudo apt-get install wget gpg coreutils
  become: yes

- name: gpgp set 
  shell : wget -O- https://apt.releases.hashicorp.com/gpg | sudo gpg --dearmor -o /usr/share/keyrings/hashicorp-archive-keyring.gpg
  become: yes

- name:
  shell: 
       |
       echo "deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/hashicorp.list
       sudo apt-get update && sudo apt-get install nomad
  become: yes

- name: Clone nomad
  shell: git clone https://github.com/hashicorp-education/learn-nomad-getting-started.git
  become: yes

- name: cd learn-nomad-getting-started
  shell: cd learn-nomad-getting-started
  become: yes

- name: git checkout -b nomad-getting-started v1.1
  shell: git checkout -b nomad-getting-started v1.1
  become: yes

- name: Start nomad ina terminal
  shell: > 
    sudo nomad agent -dev 
    -bind 0.0.0.0 
    -network-interface='{{ GetDefaultInterfaces | attr "name" }}'
  become: yes

- name: export 
  shell: export NOMAD_ADDR=http://localhost:4646
  become: yes

