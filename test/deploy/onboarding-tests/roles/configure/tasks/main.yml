---
- debug:
    msg: Tests E2E

- name: Clone the Onboarding tests repository
  git:
    repo: https://github.com/newrelic/onboarding-e2e-tests.git
    dest: /home/user/
become: yes

- name: Write Permissions for repo
  shell: "chmod 755 onboarding-e2e-tests"
  become: yes

- name: Trigger Onboarding tests
  shell: "cd onboarding-e2e-tests"
  become: yes

- name: Create env file
  shell: "touch .env"
  become: yes

- name: Store values in env file
  shell: "echo -e ENV_SECRET_EMAIL='${ENV_SECRET_EMAIL}' \nENV_SECRET_PASSWORD='${ENV_SECRET_PASSWORD}' > .env"
  become: yes

- name: npm install
  shell: "npm install"
  become: yes

- name: Install Playwright
  shell: "npx playwright@1.32.0 install --with-deps chromium"
  become: yes

- name: Test playwright scripts
  shell: "npx playwright test"
  become: yes

