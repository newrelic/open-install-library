---
- debug:
    msg: Install JMX-Tomcat

- name: Download Tomcat
  shell: wget https://downloads.apache.org/tomcat/tomcat-7/v7.0.107/bin/apache-tomcat-7.0.107.zip
  become: true

- name: Install unzip and java
  apt:
    name: ['unzip', 'default-jdk']
    update_cache: yes
    state: latest
  become: true

- name: Unpack Tomcat
  shell: unzip apache-tomcat-7.0.107.zip
  become: true

- name: Move Tomcat to Opt
  shell: mv apache-tomcat-7.0.107 /opt/
  become: true

- name: Copy file with JMX configured
  template:
    src: setenv.sh
    dest: /opt/apache-tomcat-7.0.107/bin/setenv.sh
  become: true

- name: Set permissions for tomcat scripts
  shell: chmod 755 /opt/apache-tomcat-7.0.107/bin/*.sh
  become: true

- name: Start tomcat
  shell: /opt/apache-tomcat-7.0.107/bin/startup.sh

- name: Export USERNAME
  shell: "echo export NR_CLI_JMX_USER=admin >> ~/.bashrc"

- name: Export PASSWORD
  shell: "echo export NR_CLI_JMX_PASS=admin >> ~/.bashrc"

- name: Export HOSTNAME
  shell: "echo export NR_CLI_JMX_HOST=localhost >> ~/.bashrc"

- name: Export DB_PORT
  shell: "echo export NR_CLI_JMX_PORT=9999 >> ~/.bashrc"

