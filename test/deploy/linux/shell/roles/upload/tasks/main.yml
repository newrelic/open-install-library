---
# Parameters:
# step_upload_file_base64: A base64 encoded file
# step_upload_file_name: A filename to write the file to

- block:
  - fail:
      msg: "A step_upload_file_name is required. Create this entry in your user config file"
    when: step_upload_file_name is not defined
  - name: decode base64 file
    set_fact:
      step_upload_file_content: "{{step_upload_file_base64 | b64decode}}"
  - name: Copy file to remove
    ansible.builtin.copy:
      content: "{{ step_upload_file_content }}"
      dest: "{{ step_upload_file_name }}"
    register: output
    become: true
  - fail:
      msg: "The command failed to upload the file {{ step_upload_file_name}} details:{{ output.stdout }}"
    when: output is failed
  when: step_upload_file_base64 is defined
