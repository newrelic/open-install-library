---
- debug:
    msg: Install ElasticSearch

- name: Set default create_env_var (default not create)
  set_fact:
    create_env_var: "false"
  when: create_env_var is undefined
  
- name: Copy Epel repo file
  template:
    src: epel.repo
    dest: /etc/yum.repos.d/epel.repo
  become: true

- name: clean yup repos
  shell: yum clean all -y
  become: true

- name: yum repolist
  shell: yum repolist -y
  become: true

- name: install Redis from EPEL repository
  shell: yum install redis -y
  become: true 

- name: run redis
  shell: service redis start
  become: true 

- block:
  - name: Export USERNAME
    shell: "echo export NR_CLI_PASSWORD=notUsed >> ~/.bashrc"
  - name: Export PASSWORD
    shell: "echo export NR_CLI_KEYS=None >> ~/.bashrc"
  - name: Export HOSTNAME
    shell: "echo export NR_CLI_HOSTNAME=localhost >> ~/.bashrc"
  - name: Export ES_PORT
    shell: "echo export NR_CLI_PORT=6379 >> ~/.bashrc"
  when: create_env_var|bool
