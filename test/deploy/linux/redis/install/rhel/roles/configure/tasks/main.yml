---
- debug:
    msg: Install ElasticSearch

- name: Set default create_env_var (default not create)
  set_fact:
    create_env_var: "false"
  when: create_env_var is undefined
  
- name: Copy Epel repo file
  template:
    src: epel.repo
    dest: /etc/yum.repos.d/epel.repo
  become: true

- name: clean yup repos
  shell: yum clean all -y
  become: true

- name: yum repolist
  shell: yum repolist -y
  become: true

- name: install Redis from EPEL repository
  shell: yum install redis -y
  become: true 

- name: run redis
  shell: service redis start
  become: true 

- block:
  - name: EXPORT HOSTNAME
    shell: "echo export NR_CLI_HOSTNAME=localhost >> ~/.bashrc"
  - name: EXPORT PORT
    shell: "echo export NR_CLI_PORT=6739 >> ~/.bashrc"
  - name: EXPORT UNIX_SOCKET_PATH
    shell: "echo export NR_CLI_UNIX_SOCKET_PATH=None >> ~/.bashrc"
  - name: EXPORT KEYS
    shell: "echo export NR_CLI_KEYS=None >> ~/.bashrc"
  - name: EXPORT KEYS_LIMIT
    shell: "echo export NR_CLI_KEYS_LIMIT=30 >> ~/.bashrc"
  - name: EXPORT PASSWORD
    shell: "echo export NR_CLI_PASSWORD=testpassword >> ~/.bashrc"
  when: create_env_var|bool
