---
- debug:
    msg: Install Redis

- name: Set default create_env_var (default not create)
  set_fact:
    create_env_var: "false"
  when: create_env_var is undefined

- name: Get latest packages info
  shell: "apt-get update -y"
  become: true
  register: output_aptget
  retries: 20
  delay: 15
  until: output_aptget is not failed

- name: Install redis
  apt:
    name: ['redis']
  become: yes

- name: Copy redis config
  template: 
      src: redis.conf
      dest: /etc/redis/redis.conf
  become: true

- name: Restart Redis
  shell: "systemctl restart redis"
  become: true

- block:
  - name: Export PASSWORD
    shell: "echo export NR_CLI_PASSWORD=Virtuoso4all! >> ~/.bashrc"
  - name: Export KEYS
    shell: echo export NR_CLI_KEYS=None >> ~/.bashrc
  - name: Export HOSTNAME
    shell: "echo export NR_CLI_HOSTNAME=localhost >> ~/.bashrc"
  - name: Export PORT
    shell: "echo export NR_CLI_PORT=6379 >> ~/.bashrc"
  when: create_env_var|bool
